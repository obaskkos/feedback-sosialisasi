<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulir Umpan Balik Sosialisasi Database</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .rating-label { width: 3rem; }
    .rating-grid {
      display: grid;
      grid-template-columns: 1fr repeat(5, minmax(0, 1fr));
      align-items: center;
      /* Pastikan responsif pada layar kecil */
      @media (max-width: 768px) {
        grid-template-columns: 1fr repeat(5, 40px);
      }
    }

    /* üîî Toast Notification Styles */
    .toast {
      position: fixed;
      top: 1.5rem;
      right: 1.5rem;
      min-width: 250px;
      padding: 1rem 1.25rem;
      border-radius: 0.5rem;
      color: white;
      font-weight: 500;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      opacity: 0;
      transform: translateY(-20px);
      transition: all 0.3s ease-in-out;
      z-index: 9999;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast.success { background-color: #16a34a; } /* green-600 */
    .toast.error { background-color: #dc2626; }    /* red-600 */
  </style>
</head>

<body class="bg-gradient-to-br from-blue-50 via-white to-green-50 min-h-screen flex items-start justify-center py-12 px-4 sm:px-6 lg:px-8">

  <div class="w-full max-w-3xl bg-white p-8 md:p-10 rounded-2xl shadow-xl space-y-8 border border-gray-100">
    <header class="text-center mb-6">
      <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-800">üóÇÔ∏è Form Umpan Balik Sosialisasi Database</h1>
      <p class="mt-2 text-sm text-gray-500 italic">OBA / SK / KOS</p>
    </header>

    <p class="text-sm text-center text-gray-700 p-4 bg-blue-50 border border-blue-100 rounded-md">
      Terima kasih atas partisipasi Anda! Masukan ini akan digunakan untuk meningkatkan kualitas database ke depan.
    </p>

    <form id="data-form" class="space-y-8">
      <!-- Informasi Peserta -->
      <section class="space-y-4">
        <h2 class="text-xl font-semibold text-gray-800 border-b pb-2">üßë‚Äç Informasi Peserta</h2>
        <div>
          <label for="nama_peserta" class="block text-sm font-medium text-gray-700">Nama Peserta</label>
          <input type="text" id="nama_peserta" name="nama_peserta" required
            class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
        </div>

        <div>
          <label for="unit_kerja" class="block text-sm font-medium text-gray-700">Unit Kerja</label>
          <select id="unit_kerja" name="unit_kerja" required
             class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 sm:text-sm bg-white">
            <option value="" disabled selected>Pilih unit kerja Anda</option>
            <option value="Loka POM di Kabupaten Sumba Timur">Loka POM di Kabupaten Sumba Timur</option>
            <option value="Unit Kerja Lainnya">Unit Kerja Lainnya</option>
            <option value="Eksternal BPOM">Eksternal BPOM</option>
          </select>
        </div>
      </section>

      <!-- Bagian A -->
      <section class="space-y-4">
        <h2 class="text-xl font-semibold text-gray-800 border-b pb-2">üìä Bagian A. Penilaian Kegiatan</h2>
        <p class="text-sm text-gray-600 mb-2">Beri penilaian Anda (1 = Sangat Tidak Setuju, 5 = Sangat Setuju):</p>

        <div class="overflow-x-auto bg-gray-50 p-4 rounded-lg border border-gray-200">
          <div id="rating-container" class="rating-grid gap-y-3 min-w-[650px]">
            <div class="font-medium text-gray-700">Aspek</div>
            <div class="text-center font-medium text-gray-700 rating-label">1</div>
            <div class="text-center font-medium text-gray-700 rating-label">2</div>
            <div class="text-center font-medium text-gray-700 rating-label">3</div>
            <div class="text-center font-medium text-gray-700 rating-label">4</div>
            <div class="text-center font-medium text-gray-700 rating-label">5</div>
            
            <!-- Aspek akan diisi oleh JavaScript -->
          </div>
        </div>
      </section>

      <!-- Bagian B -->
      <section class="space-y-4">
        <h2 class="text-xl font-semibold text-gray-800 border-b pb-2">üí¨ Bagian B. Persepsi dan Pengalaman</h2>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Seberapa percaya diri Anda dalam menggunakan database ini?</label>
          <div class="flex flex-wrap gap-x-4 gap-y-2">
            <label class="flex items-center space-x-2"><input type="radio" name="percaya_diri" value="1" required class="text-blue-600 focus:ring-blue-500"><span class="text-sm">Tidak Percaya Diri</span></label>
            <label class="flex items-center space-x-2"><input type="radio" name="percaya_diri" value="2" class="text-blue-600 focus:ring-blue-500"><span class="text-sm">Kurang Percaya Diri</span></label>
            <label class="flex items-center space-x-2"><input type="radio" name="percaya_diri" value="3" class="text-blue-600 focus:ring-blue-500"><span class="text-sm">Cukup</span></label>
            <label class="flex items-center space-x-2"><input type="radio" name="percaya_diri" value="4" class="text-blue-600 focus:ring-blue-500"><span class="text-sm">Percaya Diri</span></label>
            <label class="flex items-center space-x-2"><input type="radio" name="percaya_diri" value="5" class="text-blue-600 focus:ring-blue-500"><span class="text-sm">Sangat Percaya Diri</span></label>
          </div>
        </div>

        <div>
          <label for="manfaat_utama" class="block text-sm font-medium text-gray-700">Apa manfaat utama yang Anda rasakan?</label>
          <textarea id="manfaat_utama" name="manfaat_utama" rows="3" required
             class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"></textarea>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700">Apakah ada bagian yang perlu perbaikan?</label>
          <div class="mt-2 flex items-center gap-4">
            <label class="flex items-center space-x-2"><input id="perbaikan_tidak" name="perbaikan_status" type="radio" value="Tidak Ada" required onchange="window.togglePerbaikanDetail()" class="text-blue-600 focus:ring-blue-500"><span class="text-sm">Tidak Ada</span></label>
            <label class="flex items-center space-x-2"><input id="perbaikan_ada" name="perbaikan_status" type="radio" value="Ada" onchange="window.togglePerbaikanDetail()" class="text-blue-600 focus:ring-blue-500"><span class="text-sm">Ada</span></label>
          </div>
        </div>

        <div id="perbaikan_detail_group" class="pl-4 hidden">
          <label for="perbaikan_detail" class="block text-sm font-medium text-gray-700 mt-2">Ada, yaitu:</label>
          <textarea id="perbaikan_detail" name="perbaikan_detail" rows="2"
             class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"></textarea>
        </div>
      </section>

      <div>
        <button type="submit" id="submit-button"
           class="w-full flex justify-center py-3 px-4 rounded-md shadow-sm text-sm font-semibold text-white bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 focus:ring-2 focus:ring-green-400 transition-all duration-300 disabled:opacity-50">
          Kirim Umpan Balik
        </button>
      </div>
    </form>

    <div id="loading-indicator" class="hidden mt-4 flex items-center justify-center space-x-2 text-green-700">
      <svg class="animate-spin h-5 w-5 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path></svg>
      <span>Mengirim umpan balik...</span>
    </div>
  </div>

  <!-- üîî Toast Container -->
  <div id="toast" class="toast hidden"></div>

  <script>
    // GANTI URL INI DENGAN URL WEB APP GOOGLE APPS SCRIPT ANDA
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzWAFTp8nGFYXLLLar3U1qZTWMeR9ZJdgZnHKhoFWEDzHncCUJB0hFQ6phP7FgkzLeS/exec'; 
    
    // --- Elemen DOM ---
    const form = document.getElementById('data-form');
    const submitButton = document.getElementById('submit-button');
    const loadingIndicator = document.getElementById('loading-indicator');
    const toast = document.getElementById('toast');
    const perbaikanDetailGroup = document.getElementById('perbaikan_detail_group');
    const perbaikanDetailTextarea = document.getElementById('perbaikan_detail');
    const ratingContainer = document.getElementById('rating-container');

    // --- FUNGSI UTILITY ---

    /** Menampilkan notifikasi Toast */
    function showToast(message, type = 'success') {
        toast.textContent = message;
        toast.className = `toast show ${type}`;
        toast.classList.remove('hidden');
        
        // Sembunyikan setelah 5 detik
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                toast.classList.add('hidden');
            }, 300); // Durasi transisi
        }, 5000);
    }

    /** Mengubah visibilitas detail perbaikan berdasarkan pilihan radio button */
    function togglePerbaikanDetail() {
        const isAdaSelected = document.getElementById('perbaikan_ada').checked;
        
        if (isAdaSelected) {
            perbaikanDetailGroup.classList.remove('hidden');
            perbaikanDetailTextarea.required = true;
        } else {
            perbaikanDetailGroup.classList.add('hidden');
            perbaikanDetailTextarea.required = false;
        }
    }
    window.togglePerbaikanDetail = togglePerbaikanDetail; // Jadikan global

    /** Mengatur status UI saat proses pengiriman */
    function setSubmissionState(isSubmitting) {
        submitButton.disabled = isSubmitting;
        if (isSubmitting) {
            loadingIndicator.classList.remove('hidden');
            submitButton.innerHTML = `<span class="flex items-center space-x-2"><svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8H4z"></path></svg><span>Mengirim...</span></span>`;
        } else {
            loadingIndicator.classList.add('hidden');
            submitButton.textContent = 'Kirim Umpan Balik';
        }
    }

    /** Fungsi penanganan pengiriman formulir menggunakan Apps Script */
    async function handleSubmit(event) {
        event.preventDefault();

        // Validasi kustom untuk radio button Bagian A
        const aspekListLength = 6;
        let isRatingValid = true;
        for (let i = 1; i <= aspekListLength; i++) {
            const radioGroup = form.elements[`aspek_${i}`];
            if (![...radioGroup].some(radio => radio.checked)) {
                isRatingValid = false;
                break;
            }
        }
        
        if (!isRatingValid) {
            showToast('Mohon lengkapi semua penilaian pada Bagian A.', 'error');
            return;
        }

        setSubmissionState(true);

        try {
            const formData = new FormData(form);
            
            // Konversi FormData ke URLSearchParams untuk GAS compatibility
            const searchParams = new URLSearchParams();
            for (const [key, value] of formData.entries()) {
                searchParams.append(key, value);
            }
            
            // Tambahkan timestamp
            searchParams.append('timestamp', new Date().toLocaleString('id-ID', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false }));
            
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // Penting untuk GAS yang di-deploy
                cache: 'no-cache',
                body: searchParams
            });

            // Karena menggunakan 'no-cors', kita harus mengasumsikan sukses jika fetch tidak gagal secara teknis (mis. network error).

            console.log("Submission sent to Google Apps Script.");
            showToast('Terima kasih! Umpan balik Anda telah diterima.', 'success');
            
            // Reset formulir setelah sukses
            form.reset();
            window.togglePerbaikanDetail(); 

        } catch (e) {
            console.error("Error submitting to GAS: ", e);
            showToast('Gagal mengirim umpan balik. Terjadi kesalahan jaringan atau skrip.', 'error');
        } finally {
            setSubmissionState(false);
        }
    }

    /** Fungsi untuk men-generate rating grid secara dinamis */
    function generateRatingGrid() {
        const aspekList = [
            'A.1 Materi mudah dipahami',
            'A.2 Praktik penyampaian jelas',
            'A.3 Fitur sesuai kebutuhan pengguna',
            'A.4 Kolom data mudah diisi',
            'A.5 Filter pencarian bermanfaat',
            'A.6 Waktu sosialisasi sudah cukup'
        ];
        
        aspekList.forEach((aspek, i) => {
            const aspekDiv = document.createElement('div');
            aspekDiv.className = 'text-sm text-gray-800';
            aspekDiv.textContent = aspek;
            ratingContainer.appendChild(aspekDiv);

            for (let j = 1; j <= 5; j++) {
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = `aspek_${i + 1}`;
                radio.value = j;
                radio.required = true;
                radio.className = 'justify-self-center h-4 w-4 text-blue-600 focus:ring-blue-500 cursor-pointer';
                ratingContainer.appendChild(radio);
            }
        });
    }

    // Panggil inisialisasi saat jendela dimuat
    window.addEventListener('load', () => {
        generateRatingGrid();
        form.addEventListener('submit', handleSubmit);
        window.togglePerbaikanDetail(); 
    });
  </script>
</body>
</html>
